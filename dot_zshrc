# zellij setup
eval "$(zellij setup --generate-auto-start zsh)"

# Enable Powerlevel10k instant prompt. Should stay close to the top of ~/.zshrc.
# Initialization code that may require console input (password prompts, [y/n]
# confirmations, etc.) must go above this block; everything else may go below.
if [[ -r "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh" ]]; then
  source "${XDG_CACHE_HOME:-$HOME/.cache}/p10k-instant-prompt-${(%):-%n}.zsh"
fi

export PATH=$HOME/bin:/usr/local/bin:$PATH

# oh-my-zsh setup
export ZSH="$HOME/.oh-my-zsh"

ZSH_THEME="macovsky"
CASE_SENSITIVE="true"
HYPHEN_INSENSITIVE="true"
COMPLETION_WAITING_DOTS="true"
DISABLE_UNTRACKED_FILES_DIRTY="true"
plugins=(git)

zstyle ':omz:update' mode auto
source "$ZSH"/oh-my-zsh.sh

# brew
eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
bprefix="$(brew --prefix)"

# TODO: Have a file for environment variables, potentially use dotenv
export EDITOR="nvim"
export VISUAL="nvim"
alias n="nvim"
alias k="clear"
alias cm="chezmoi"
alias lg="lazygit"
alias mine="open -na RubyMine.app --args \"$@\""
alias ls="eza -lah --no-user --no-permissions --sort type"
alias ll="ls"
alias cat="bat"
alias shconfig="n ~/.zshrc"
alias ideaconfig="n ~/.ideavimrc"

# TODO: have a place for work specific stuff.
alias s="bundle exec spring"

# fzf
source <(fzf --zsh)

# mise
eval "$($bprefix/bin/mise activate zsh)"

# yazi setup
function y() {
	local tmp="$(mktemp -t "yazi-cwd.XXXXXX")" cwd
	yazi "$@" --cwd-file="$tmp"
	IFS= read -r -d '' cwd < "$tmp"
	[ -n "$cwd" ] && [ "$cwd" != "$PWD" ] && builtin cd -- "$cwd"
	rm -f -- "$tmp"
}

# ===================
# work specific
# postgres
export PATH="$bprefix/opt/postgresql@14/bin:$PATH"
export PGGSSENCMODE="disable"

# fixes spring failing in macOS M4
export OBJC_DISABLE_INITIALIZE_FORK_SAFETY=YES

# attempt to figure out what's going on with freezes
SPRING_LOG=/dev/fd/2

# switch-env
if [ -f "$HOME/projects/inf-scripts/switch-env/switch-env.sh" ] ; then
        . "$HOME/projects/inf-scripts/switch-env/switch-env.sh"
fi

# eks-jumpbox-session
if [ -f "$HOME/projects/inf-scripts/eks-jumpbox-session/eks-jumpbox-session" ] ; then
        export PATH="$HOME/projects/inf-scripts/eks-jumpbox-session:$PATH"
fi

source ~/powerlevel10k/powerlevel10k.zsh-theme

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ ! -f ~/.p10k.zsh ]] || source ~/.p10k.zsh
